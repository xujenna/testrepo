<html>
<head>
  <!DOCTYPE html>
  <meta charset="utf-8">

  <style type="text/css">
    /*css to go here*/

    body {
      background-color:#f3f2f7;
      font-family: fanwood, serif;
      font-size:17px;
      font-style: text;
      text-align: center;
      letter-spacing: 0.5px;
      margin:0px;
  }


  svg {
  /*  border: 1px solid #f0f;
  */  /*color: white;*/
      /*fill: white;*/
      z-index: 2;
      display:inline;
  }


  .axis line,
  .axis path,
  .smallAxis line,
  .smallAxis path {
    fill:none;
    stroke:silver;
    stroke-width:1;
  }

  .axisLabel, .axis text {
    fill: black;
    font-family: europa, sans-serif;
    font-style: light;
    text-transform: uppercase;
    font-size: 10px;
    letter-spacing: 1px;
}

.axisLabel {
 letter-spacing: 2.5px;
 font-weight: bold;
}


  .tick line {
    fill: none;
    stroke-dasharray: 2px 4px;
  }

  .y-axis-label {
    margin-left:0px;
  }

.smallAxisLabel, .smallAxis text {
  font-size:8.5px;
  font-family: europa, sans-serif;
}

.matrix-label {
  font-size:8.5px;
  font-family: europa, sans-serif;
  transform:rotate(-45deg);
}
.regression {
  stroke-width: 2px;
/*  stroke: black;
*/  stroke-dasharray: 3.5,1.5;
}

  .time-title {
    display:inline;
  }

  .wrapper {
    height: 100%;
    display:inline;
    margin:20px;
  }


  .tooltip {
    width: 200px;
    font-family: europa, sans-serif;
    font-style: light;
    font-size: 12px;
    background:rgba(255,255,255,0.65);
    padding:5px;
    line-height:1.25;
    clear:both;
    text-align: center;
  }



  .n::after {
    font-size:18px;
    width: 200px;
    color: black;
    content: "\2193";
    position:absolute;
    text-align:center;
    display:block;
    pointer-events:none;
    margin-top:5px;
  }

  .s::before {
    font-size:18px;
    width: 200px;
    color: black;
    content: "\2191";
    position:absolute;
    text-align:center;
    display:block;
    pointer-events:none;
    clear:both;
    margin-top:-27px;
  }

  .hover-line {
  fill: none;
  stroke-dasharray: 2px 4px;
  stroke:magenta;
  stroke-width:1;
  }

.hoverLabels{
  fill: black;
  font-family: europa, sans-serif;
  font-style: light;
  font-size: 12px;
}

  .container {
    overflow: auto;
    margin-top: 70px;
    margin-bottom: 150px;
    display:block;
    width:100vw;
  }



  #intro-container {
    height:100%;
    width:100%;
    /*display:block;*/
    overflow: visible;
    /*background-color: silver;*/
    color: white;
    margin-bottom: 170px;
    padding: 105px 0 0 0;
  }

  .hero-imgs {
    overflow: auto;
    position:absolute;
    left:0px;
    top:0px;
    width:100%;
    z-index:-10;
    opacity:0.15;
  }

  .hero-imgs img {
    opacity:0.7;
    min-width:100%;
    min-height: 100%;

  }

  #intro-text {
    width:60%;
    margin:auto;
    column-count: 3;
    column-gap: 30px;
    text-align: left;
    line-height: 22px;
  }

  #hed h1 {
    margin-bottom: 30px;
    margin-top: 0px;
  }

  #hed p {
    margin-bottom: 5px;
  }

  h1 {
    font-size:60px;
    font-family: fanwood, serif;
    font-style: regular;
    font-weight: 400;
    margin-bottom: 25px;
    line-height:100px;
    margin-top:25px;
  }
  h2 {
    font-family: europa, sans-serif;
    font-size:28px;
    letter-spacing: 1px;
    font-weight:900;
    /*border-bottom: 1px solid;*/
  }

  h4 {
    font-family: europa, sans-serif;
    font-style: light;
    font-size:12px;
    letter-spacing: 8px;
    text-transform: uppercase;
    margin-bottom: -30px;
    font-weight:400;
    /*border-bottom: 1px solid;*/
  }

  h5 {
    font-family: europa, sans-serif;
    font-style: light;
    font-weight:400;
    font-size:10px;
    letter-spacing: 2px;
    text-transform: uppercase;
  }


  #context-container {
    width:100%;
    position: fixed;
    bottom:0%;
    padding-bottom:6px;
    padding-top: 16px;
    background-color: white;
    margin-bottom:0;
    margin-left:0;
  }

  .description {
    display:inline-block;
    width:20%;
    text-align: left;
    margin-top: 30px;
    padding-right: 60px;
    vertical-align:top;
  }

  .description a {
    color:black;
  }

  .description h2 {
    margin-top:10px;
    margin-bottom: 10px;
  }

  #affectiva-container .description{
    margin-top: 75px;
  }
  #context-description {
    width:360px;
    padding-right: 0px;
    margin-top: 0px;
    padding-top: 30px;
    padding-bottom: 20px;
    margin-left: -20px;
    font-family: europa, sans-serif;
    font-size:15px;
    letter-spacing: 1px;
    /*text-transform: uppercase;*/
    font-weight:600;
  }

  .arrow {
    display:block;
    width: 1px;
    height:100px;
    background-color:white;
    margin: auto;
    margin-top:
  }
  .arrow::after {
    content: "\25BE";
    display:block;
    position:relative;
    top:100px;
    text-align: center;
    margin-left:-4px;
    line-height:2px;

  }

  .alt-axis {
    font-family: europa, sans-serif;
    font-weight:600;
    font-size:12px;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .compulsion-x {
    font-family: europa, sans-serif;
    font-weight:600;
    font-size:11.5px;
    text-align: center;
  }

  #intro-text a {
    color:white;
  }

#correlation-container {
  overflow: visible;
  width:100%;
  display:inline-block;
  margin:auto;
  padding-top: 120px;
  padding-bottom: 150px;
/*  padding: 0 0 0 0;
*/  text-align: center;
  background-color:#fcf9ef;
}

#variable-description-container{
  width:100%;
  display: inline-block;
  margin:auto;
  margin-top:50px;
  font-size: 11px;
  font-family: europa, sans-serif;
  text-align: left;
  padding:14px;
  border: 1px solid black;
}
#variable-description-title {
  padding-bottom: 10px;
  border-bottom: 1px solid black;
  margin-bottom: 10px;
  font-weight: bold;
  letter-spacing: 2px;
}

#variable-description {
  column-count: 2;
  column-gap: 7px;
}
#variable-description p {
  margin:5px;
  -webkit-column-break-inside: avoid;
          page-break-inside: avoid;
               break-inside: avoid;
}

#footer{
  background-color:#fcf9ef;
  margin:auto;
  font-family: europa, sans-serif;
  width:100%;
  height: 25px;
  padding: 20px 0 20px 0;
  vertical-align: middle;
  font-size:10.5px;
  text-align: center;
  border-top: 1px solid black;
  border-width: 90%;
}

  </style>


</head>
<body>
  <title>Speak, (Random Access) Memory</title>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/d3-time.v1.min.js"></script>
  <script src="d3-tip.js"></script>
  <script src="jquery-3.3.1.js"></script>

  <link rel="stylesheet" href="https://use.typekit.net/fao6qlb.css">

  <div id="intro-container">
    <div class="hero-imgs"><img src="imgs/snapshot-00000-2018-04-19_02-22-07.601.jpg"></div>
    <div class="hero-imgs"><img src="imgs/snapshot-00000-2018-04-19_03-22-10.518.jpg"></div>
    <div class="hero-imgs"><img src="imgs/snapshot-00000-2018-04-19_13-11-32.417.jpg"></div>
    <div class="hero-imgs"><img src="imgs/snapshot-00000-2018-04-19_14-11-35.779.jpg"></div>
    <div class="hero-imgs"><img src="imgs/snapshot-00000-2018-04-19_15-22-34.598.jpg"></div>
    <div class="hero-imgs"><img src="imgs/snapshot-00000-2018-04-19_17-22-40.649.jpg"></div>
    <div class="hero-imgs"><img src="imgs/snapshot-00000-2018-04-19_18-45-16.276.jpg"></div>
    <div class="hero-imgs"><img src="imgs/snapshot-00000-2018-04-19_19-45-20.014.jpg"></div>
    <div class="hero-imgs"><img src="imgs/snapshot-00000-2018-04-19_21-50-44.028.jpg"></div>
    <div class="hero-imgs"><img src="imgs/snapshot-00000-2018-04-19_22-50-46.904.jpg"></div>

    <div id="hed">
    <p>üòêüòêüòêüòêüò±</p>
    <h1>Speak, (Random Access) Memory</h1>
  </div>
  <div id = "intro-text">
    This semester, I began work on a system of trackers for a whole host of potential/evidenced metrics of depression, in hopes of monitoring its cyclical nature and identifying correlations with my activity and environment. I was motivated to do this for three main reasons: 1) I have a terrible memory, which makes it difficult to accurately report necessary information in weekly therapy sessions, 2) I have a terrible memory, and therefore tend to be totally unaware of my long-term behavior, and 3) I'm slightly impulsive, and therefore tend to be totally unconcerned with the repercussions of my long-term behavior.<p>Ultimately, I hope to predict the onset of depression by feeding this data into a neural network, and perhaps even preempt it by teaching the NN to recommend/enforce interventions. As a preliminary exercise, I've trained a couple ML models to predict mood with only a month of data; <a href="http://www.xujenna.com/itp_blog/2018/05/02/final-pt-2-data-analysis/" target="new">see the documentation here</a>.</p><p>Below are visualizations of a week's worth of data collected by my <a href="http://www.xujenna.com/itp_blog/2018/04/26/final/" target="new">homemade python trackers</a>. The brush at the bottom of the page controls the time domain of all charts.</p>
  </div>
    <br><br><br><br><p><h5>To begin, filter the data by date:</h5><span class="arrow"></span></p>
  </div>
  </div>

  <div class="container" id="reporter-container">
    <div class="description"><h2>Mood Reporter</h2>
    Because affect is difficult to measure, psychiatry traditionally employs self-administered questionnaires as diagnostic tools for mood disorders; these usually attempt to quantify the severity of DSM-IV criteria. The module for depression is called the PHQ-9, and I've adapted several of its questions into my own questionnaire, which python deploys every hour via the command line. The visualization to the left includes ratings from 1-5 for <span style="color:rgb(255, 0, 255)"><b>mood</b></span>, <span style="color:rgb(245, 205, 0)"><b>morale</b></span>, <span style="color:rgb(0, 0, 255)"><b>stress</b></span>, and <span style="color:rgb(200, 200, 220)"><b> fatigue</b> </span>. Hovering over the fuchsia points on the mood line will display qualitative explanations for its respective score. The <span style="color:rgb(0, 0, 255)"><b>x's</b></span> denote the occurence of compulsions.
    </div>
    <svg id="reporter"></svg>
  </div>

  <div class="container" id="affectiva-container">
    <div class="description"><h2>Facial Analysis</h2>
      This tracker utilizes the Affectiva API, an emotion and facial recognition model. Via my laptop's webcam, it analyses my face for a minute every hour; a python script grabs the min and max <span style="color:rgb(255, 0, 255)"><b>attention</b></span> and <span style="color:rgb(0, 225, 225)"><b>valence</b></span> values, as well as the expressions made (plotted with emoji) and the amount of times I <span style="color:rgb(0, 0, 255)"><b>blinked</b></span> (calculated by dividing the number of times the eyeClosure variable hit 99.9%, divided by 2).<p>I choose these variables as <a href="http://www.xujenna.com/itp_blog/2018/02/01/blinking-mind-wandering/" target="new">an attempt to measure mindwandering</a>, a marker strongly correlated with depression. The emojis were included to illustrate the concept of valence (and also just for funsies).</p> <p>The <span style="color:rgb(245, 205, 0)"><b>area graph</b></span> visualizes my productivity score as calculated by <a href="https://www.rescuetime.com/" target="new">RescueTime</a>, and is included to contextualize Affectiva's attention scores.</p>
    </div>
    <svg id="affectiva"></svg>
  </div>

  <div class="container" id="keylogger-container">
    <div class="description"><h2>Keylogger Sentiments</h2>
      As an attempt to automatically measure mood, I created a sentiment analysis keylogger for my computer. Written in python, the keylogger collects any coherent phrase I type, and sends the log every hour to IBM's Tone Analyzer. The API provides several sentiment categories‚Äî<span style="color:rgb(255, 0, 255)"><b>joy</b></span>, <span style="color:rgb( 0, 255, 127)"><b>confidence</b></span>, <span style="color:rgb(245, 205, 0)"><b>analysis</b></span>, <span style="color:rgb(200, 200, 220)"><b>tentativeness</b></span>, <span style="color:rgb(0, 225, 225)"><b>sadness</b></span>, <span style="color:rgb(0, 0, 225)"><b>fear</b></span>, and <span style="color:rgb(255, 105, 180)"><b>anger</b></span>‚Äî as well as scores of their perceived dominance (featured in the y axis). The actual logs have been redacted for publication, but the length of the analyzed sentence is encoded in each circle's diameter.<p>I have recently added keystroke dynamics and simple text analysis to the keylogger, and hope to visualize these metrics soon.</p>
    </div>
    <svg id="keylogger"></svg>
  </div>

  <div class="container" id="tabCounter-container">
    <div class="description"><h2>Browser Activity</h2>
    This tracker is a Chrome Extension that counts the number of tabs as they're <span style="color:rgb( 0, 255, 127)"><b>created</b></span> and <span style="color:rgb(245, 205, 0)"><b>activated</b></span>, as well as the final <span style="color:rgb(255, 0, 255)"><b>hourly count</b></span>. I wanted to track my browser activity because I've noticed a relationship between all of these variables and my motivation and stress levels. I'm a tab hoarder in general, but if I'm feeling especially overwhelmed, scatterbrained, or lethargic, I'm likely to open tabs without even consuming their content, thus leaving them open indefinitely. The growing number of tabs in the browser graveyard further contributes to the feeling that I've lost control of my life, effectively creating a positive feedback loop of mounting existential dread.
    </div>
    <svg id="tabCounter"></svg>
  </div>
  <div class="container" id="context-container">
    <div class="description" id="context-description"></div>
    <svg id="context"></svg>
  </div>

<div class="container" id="correlation-container">
  <div class="description">
    <h2>Metrics Key</h2>
    To get a sense of emerging correlations, we can look at 1) scatterplots, the shape of which suggests strength of correlation, 2) linear regression, the slope of which expresses the magnitude of how <span style="color:rgb(255, 0, 255)"><b>positive</b></span> or <span style="color:rgb(0, 0, 255)"><b>negative</b></span> a correlation is, and 3) Pearson coefficients, which measure the linear correlation between two variables within a range of -1 to 1.
    <p>A pearson correlation coefficient matrix‚Äîbased on two months of data‚Äîcan be generated by comparing "All" with "All" via the dropdown menus, below. Comparing a metric with another metric, or "All", will generate scatterplots and trendlines. Tabcounter data to come.</p>

    <form>
    <select id = "selection1">
    <option selected="selected"><b>Select an X-Axis Metric:</b></option>
    </select>
    </form>
    <form>
      <select id = "selection2">
      <option selected="selected"><b>Select an Y-Axis Metric:</b></option>
      </select>
    </form>
  <div id="variable-description-container">
  <div id="variable-description-title">METRICS KEY</div>
  <div id="variable-description"></div>
</div>
  </div>
  <svg id="correlations"></svg>
</div>

<div id="footer">
  A project by <a href="http://www.xujenna.com" target="new">Jenna Xu</a>, created during the Spring 2018 semester at ITP. Featured in Mozilla's <a href="https://foundation.mozilla.org/opportunity/artists-open-web/" target="new"><i>Artists Open Web</i></a>. Special thanks to <a href="https://www.quora.com/profile/Kevin-Lin" target="new">Kevin Lin</a> for being a genius.</div>
<script>


var margin = {top: 50, right: 30, bottom: 50, left: 50};
var margin2 = {top: 5, right:30, bottom:20, left:50};

var width = 1000 - margin.left - margin.right,
height = 500 - margin.top - margin.bottom;

var height2 = 80 - margin2.top - margin2.bottom;

var body = d3.select("body");

var contextSVG = d3.select("#context")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height2 + margin2.top + margin2.bottom);


var reporterSVG = d3.select("#reporter")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom);


var xScale = d3.scaleTime()
  .range([0,width]);
  // .domain([xMin, xMax]);

var xScale2 = d3.scaleTime()
.range([0,width]);

var yScale = d3.scaleLinear()
  .range([height,0]);
  // .domain([0.45,1]);

var yScale2 = d3.scaleLinear()
  .range([height2,0]);

var xAxis = d3.axisBottom(xScale).tickPadding(10);
var xAxis2 = d3.axisBottom(xScale2).tickSize(-height2).tickPadding(10);
var yAxis = d3.axisLeft(yScale).tickSize(-width).ticks(5).tickPadding(10);


var reporterChart = reporterSVG.append("g")
  .attr("class", "focus")
  .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var contextChart = contextSVG.append("g")
  .attr("class", "context")
  .attr("transform", "translate(" + margin2.left + "," + margin2.top + ")");



  var brush = d3.brushX()
    .extent([[0,0], [width, height2]])
    .on("brush end", brushed);


  var moodArea = d3.area()
      // .curve(d3.curveCardinal)
      .x(function(d) { return xScale(d.time); })
      .y1(function(d) { return yScale(d.mood); })
      .y0(height)
        .defined(function(d){return d.mood!=null;});

  var fatigueArea = d3.area()
    // .curve(d3.curveCardinal)
    .x(function(d) { return xScale(d.time); })
    .y1(function(d) { return yScale(d.fatigue); })
    .y0(height)
      .defined(function(d){return d.fatigue!=null;});


  var stressArea = d3.area()
      // .curve(d3.curveCardinal)
      .x(function(d) { return xScale(d.time); })
      .y1(function(d) { return yScale(d.stress); })
      .y0(height)
        .defined(function(d){return d.stress!=null;});

  var moraleArea = d3.area()
      // .curve(d3.curveCardinal)
      .x(function(d) { return xScale(d.time); })
      .y1(function(d) { return yScale(d.morale); })
      .y0(height)
        .defined(function(d){return d.morale!=null;});


  var moodLine = d3.line()
  .defined(function(d){return d.mood!=null})
    .x(function(d) {return xScale(d.time);})
    .y(function(d){return yScale(d.mood) - 1.5;});

  var moodLine2 = d3.line()
  .defined(function(d){return d.mood!=null})
    .x(function(d) {return xScale2(d.time);})
    .y(function(d){return yScale2(d.mood);});

var newResponses = [];



d3.tsv("responses.tsv", function (err, responses) {

    if (err) console.warn(err, "error loading data");


responses.forEach(function(d){
  var dateTime = new Date(String(d.time));
  d.time = dateTime;
  d.mood = +d.mood;
  d.fatigue = +d.fatigue;
  d.morale = +d.morale;
  d.social = +d.social;
  d.stress = +d.stress;
});



responses.forEach(function(d,i){

newResponses.push(d)

  if(i+1 == responses.length){
    return;
  }


  var timee = responses[i+1].time;


  if(d.time < (timee - 24000000)) {
    var nullTime = new Date(timee - 24000000);
    var nullItems = {};

    nullItems["time"] = nullTime;
    nullItems["mood"] = null;
    nullItems["moodNotes"] = null;
    nullItems["fatigue"] = null;
    nullItems["stress"] = null;
    nullItems["activities"] = null;
    nullItems["morale"] = null;
    nullItems["compulsions"] = null;

    newResponses.push(nullItems);
  }

})


// var xMin = new Date(1524982083090);
// var xMax = new Date(1526256483085);

var xMin = new Date("2018-04-28T19:00:00.000000");
var xMax = new Date("2018-05-04T17:00:00.000000");

xScale.domain([xMin, xMax]);
yScale.domain([0,5]);
xScale2.domain(xScale.domain());
yScale2.domain(yScale.domain());



reporterChart.append("g")
  .attr("class", "axis axis--x")
  .attr("transform","translate(0, "+(height)+")")
  .call(xAxis);

reporterChart.append("g")
.attr("class", "axis axis--y")
  .call(yAxis);



reporterChart.append("path")
  .datum(newResponses)
  .attr("class", "moodArea")
  .attr("d", moodArea)
  .attr("fill", "magenta")
  .attr("opacity", 0.4);

reporterChart.append("path")
  .datum(newResponses)
  .attr("class", "moraleArea")
  .attr("d", moraleArea)
  .attr("fill", "gold")
  .attr("opacity", 0.4);


reporterChart.append("path")
  .datum(newResponses)
  .attr("class", "stressArea")
  .attr("d", stressArea)
  .attr("fill", "blue")
  .attr("opacity", 0.25);


reporterChart.append("path")
  .datum(newResponses)
  .attr("class", "fatigueArea")
  .attr("d", fatigueArea)
  .attr("fill", "lavender")
  .attr("opacity", 0.7);



var compulsionCircles = reporterChart.selectAll(".compulsion-circle")
  .data(newResponses)
  .enter()
  .append("text")
  .attr("class","compulsion-x")
  .attr("x", function(d) {return xScale(d.time) - 1200})
  .text(function(d){ return d.compulsions == "False" || d.compulsions == null ? console.log("null") : "x"})
  .attr("y", function(d){return yScale(d.stress) + 3;})
  .attr("opacity", 0.7)
  .attr("fill", "blue");

reporterChart.append("path")
  .datum(newResponses)
  .attr("d", moodLine)
  .attr("stroke", "magenta")
  .attr("stroke-width", 2)
  .attr("fill", "none")
  .attr("class", "moodLine")
  .attr("opacity", 0.7);


var moodCircles = reporterChart.selectAll(".moodCircle")
  .data(newResponses)
  .enter()
  .append("circle")
  .attr("class","moodCircle")
  .attr("cx", function(d) {return xScale(d.time)})
  .attr("r", function(d) {return d.mood == null ? 0 : 3; })
  .attr("cy", function(d) { return yScale(d.mood);})
  .attr("opacity", 0.7)
  .attr("fill", "magenta");


contextChart.append("g")
    .attr("class", "axis")
    .attr("transform", "translate(0," + height2 + ")")
    .call(xAxis2);

contextChart.append("g")
    .attr("class", "brush")
    .call(brush)
    .call(brush.move, xScale.range());

contextChart.append("path")
  .attr("d", moodLine2(newResponses))
  .attr("stroke", "black")
  .attr("stroke-width", 2)
  .attr("fill", "none")
  .attr("class", "line");




  var reporterTip = d3.tip()
    .attr("class", "tooltip")
    .offset([-20,-5])
    .html(function(d,i) {
    return "<b>" + d.moodNotes + "</b>: " + d.trigger;
    });


  reporterChart.selectAll(".moodCircle")
  .call(reporterTip)

  .on("mouseover", function(d) {
    reporterTip.show(d);
  })

  .on("mouseout", function(d) {
    reporterTip.hide(d);
  })


});

var formatTime = d3.timeFormat("%b %d %I:%M%p");

function brushed() {
  if (d3.event.sourceEvent && d3.event.sourceEvent.type === "zoom") return; // ignore brush-by-zoom
  var s = d3.event.selection || xScale2.range();
  var newDateRange = s.map(xScale2.invert, xScale2);
  for(var i = 0; i < newDateRange.length; i++) {
    newDateRange[i] = formatTime(newDateRange[i])
  }
  xScale.domain(s.map(xScale2.invert, xScale2));
  body.select("#context-description").html("Viewing " + newDateRange[0] + " ‚Äî " + newDateRange[1]);
  reporterChart.select(".moodArea").attr("d", moodArea);
  reporterChart.select(".moodLine").attr("d", moodLine);
  reporterChart.selectAll(".moodCircle").attr("cx", function(d) {return xScale(d.time)}).attr("cy", function(d) {return yScale(d.mood)});
  reporterChart.select(".moraleArea").attr("d", moraleArea);
  reporterChart.select(".stressArea").attr("d", stressArea);
  reporterChart.select(".fatigueArea").attr("d", fatigueArea);
  reporterChart.selectAll(".compulsion-x").attr("x", function(d) {return xScale(d.time)});
  keyloggerChart.selectAll(".joy-circle").attr("cx", function(d) {return xScale(d.time)}).attr("cy", function(d) {return yScaleKeylogger(d.score)});
  keyloggerChart.selectAll(".sad-circle").attr("cx", function(d) {return xScale(d.time)}).attr("cy", function(d) {return yScaleKeylogger(d.score)});
  keyloggerChart.selectAll(".tentative-circle").attr("cx", function(d) {return xScale(d.time)}).attr("cy", function(d) {return yScaleKeylogger(d.score)});
  keyloggerChart.selectAll(".angry-circle").attr("cx", function(d) {return xScale(d.time)}).attr("cy", function(d) {return yScaleKeylogger(d.score)});
  keyloggerChart.selectAll(".confident-circle").attr("cx", function(d) {return xScale(d.time)}).attr("cy", function(d) {return yScaleKeylogger(d.score)});
  keyloggerChart.selectAll(".analytical-circle").attr("cx", function(d) {return xScale(d.time)}).attr("cy", function(d) {return yScaleKeylogger(d.score)});
  keyloggerChart.selectAll(".disgust-circle").attr("cx", function(d) {return xScale(d.time)}).attr("cy", function(d) {return yScaleKeylogger(d.score)});
  keyloggerChart.selectAll(".fear-circle").attr("cx", function(d) {return xScale(d.time)}).attr("cy", function(d) {return yScaleKeylogger(d.score)});
  blinksChart.selectAll(".blink-circle").attr("cx", function(d) {return xScale(d.time)});
  expressionsChart.select(".productivityArea").attr("d", productivityArea);
  expressionsChart.selectAll(".attentionLines").attr("x1", function(d){ return xScale(d.time);}).attr("x2", function(d) {return xScale(d.time);});
  expressionsChart.selectAll(".valenceLines").attr("x1", function(d){ return xScale(d.time);}).attr("x2", function(d) {return xScale(d.time);});
  emojiChart.selectAll(".emoji").attr("transform", function(d) {return "translate(" + (xScale(d.time)-7) + ")";});
  tabCounterChart.select(".tabLine").attr("d", tabLine);
  // tabCounterChart.select(".windowLine").attr("d", windowLine);
  tabCounterChart.selectAll("rect").attr("x", function(d) { return xScale(dataset[d].timestamp); }).attr("width", (xScale(new Date("Sun Apr 29 2018 02:00:00 GMT-0500 (CDT)")) - xScale( new Date("Sun Apr 29 2018 01:00:00 GMT-0500 (CDT)"))));
  tabCounterChart.selectAll(".tabCircle").attr("cx", function(d) {return xScale(dataset[d].timestamp)});
  tabCounterChart.selectAll(".windowCircle").attr("cx", function(d) {return xScale(dataset[d].timestamp)});
  body.selectAll(".axis--x").call(xAxis);
}

    

let scrub = document.getElementById("context-container")

window.addEventListener("scroll", function(){
  if(window.scrollY > 3375){
    scrub.style.position = "inherit"
  }
  else if(window.scrollY <= 3375){
    scrub.style.position = "fixed"

  }

})

</script>
<script>

var keyloggerSVG = d3.select("#keylogger")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
var keyloggerChart = keyloggerSVG.append("g")
        .attr("class", "keyloggerG")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


var yScaleKeylogger = d3.scaleLinear()
  .range([height,0]);
  // .domain([0.45,1]);
var yAxisKeylogger = d3.axisLeft(yScaleKeylogger).tickSize(-width).ticks(4).tickPadding(10).tickFormat(function(d) { return d*100 + "%"; });



  d3.json("log.json", ready);

  function ready(err, data) {
      if (err) console.warn(err, "error loading data");

  data.forEach(function(d){
    var dateTime = new Date(String(d.time));
    d.time = dateTime;
  })


  var joy = [];
  var sadness = [];
  var confidence = [];
  var analytical = [];
  var anger = [];
  var disgust = [];
  var fear = [];
  var tentative = [];

  data.filter(function(d) {
    var holder;
    for(var i = 0; i < d.sentences_tone.length; i++) {
      if(d.sentences_tone[i].tones.length > 0) {
      for(var j = 0; j < d.sentences_tone[i].tones.length; j++) {
          if(d.sentences_tone[i].tones[j].tone_name == "Joy"){
            holder = d.sentences_tone[i].tones[j];
            holder["time"]=d.time;
            holder["sentence"]=d.sentences_tone[i].text;
            joy.push(holder);
            holder = "";
          }
          else if (d.sentences_tone[i].tones[j].tone_name == "Sadness"){
            holder = d.sentences_tone[i].tones[j];
            holder["time"]=d.time;
            holder["sentence"]=d.sentences_tone[i].text;
            sadness.push(holder);
            holder = "";
          }
          else if (d.sentences_tone[i].tones[j].tone_name == "Confident"){
            holder = d.sentences_tone[i].tones[j];
            holder["time"]=d.time;
            holder["sentence"]=d.sentences_tone[i].text;
            confidence.push(holder);
            holder = "";
          }
          else if (d.sentences_tone[i].tones[j].tone_name == "Analytical"){
            holder = d.sentences_tone[i].tones[j];
            holder["time"]=d.time;
            holder["sentence"]=d.sentences_tone[i].text;
            analytical.push(holder);
            holder = "";
          }
          else if (d.sentences_tone[i].tones[j].tone_name == "Anger"){
            holder = d.sentences_tone[i].tones[j];
            holder["time"]=d.time;
            holder["sentence"]=d.sentences_tone[i].text;
            anger.push(holder);
            holder = "";
          }
          else if (d.sentences_tone[i].tones[j].tone_name == "Disgust"){
            holder = d.sentences_tone[i].tones[j];
            holder["time"]=d.time;
            holder["sentence"]=d.sentences_tone[i].text;
            disgust.push(holder);
            holder = "";
          }
          else if (d.sentences_tone[i].tones[j].tone_name == "Fear"){
            holder = d.sentences_tone[i].tones[j];
            holder["time"]=d.time;
            holder["sentence"]=d.sentences_tone[i].text;
            fear.push(holder);
            holder = "";
          }
          else if (d.sentences_tone[i].tones[j].tone_name == "Tentative"){
            holder = d.sentences_tone[i].tones[j];
            holder["time"]=d.time;
            holder["sentence"]=d.sentences_tone[i].text;
            tentative.push(holder);
            holder = "";
          }
        }
      }
    }
  });



  var tip = d3.tip()
    .attr("class", "tooltip")
    .offset([-20,-5])
    .html(function(d,i) {
    return "<b>" + (d.score * 100) + "% " + d.tone_name + "</b><br> " + d.sentence.length + " characters";
    });

  // xScale.domain(d3.extent(newResponses, function(d) {return d.time;}));
  yScaleKeylogger.domain([0.45,1]);
  // xScale2.domain(xScale.domain());
  // yScale2.domain(yScale.domain());

  keyloggerChart.append("g")
    .attr("class", "axis axis--x")
    .attr("transform","translate(0, "+(height)+")")
    .call(xAxis);

  keyloggerChart.append("g")
  .attr("class", "axis axis--y")
    .call(yAxisKeylogger);




    var joyCircles = keyloggerChart.selectAll(".joy-circle")
      .data(joy)
      .enter()
      .append("circle")
      .attr("class","joy-circle")
      .attr("cx", function(d) {return xScale(d.time)})
      .attr("cy", function(d) {return yScaleKeylogger(d.score)})
      .attr("r", function(d) { return d.sentence.length / 10;})
      .attr("fill-opacity", function(d) { return Math.pow(d.score, 3);})
      .attr("fill", "fuchsia");

    var confidentCircles = keyloggerChart.selectAll(".confident-circle")
      .data(confidence)
      .enter()
      .append("circle")
      .attr("class", "confident-circle")
      .attr("cx", function(d) {return xScale(d.time)})
      .attr("cy", function(d) {return yScaleKeylogger(d.score)})
      .attr("r", function(d) { return d.sentence.length / 10;})

      // .attr("r", function(d) { return Math.pow(d.score, 3) * 20;})
      .attr("fill-opacity", function(d) { return Math.pow(d.score, 3);})
      .attr("fill", "springgreen");

    var analyticalCircles = keyloggerChart.selectAll(".analytical-circle")
      .data(analytical)
      .enter()
      .append("circle")
      .attr("class", "analytical-circle")
      .attr("cx", function(d) {return xScale(d.time)})
      .attr("cy", function(d) {return yScaleKeylogger(d.score)})
      .attr("r", function(d) { return d.sentence.length / 10;})

      // .attr("r", function(d) { return Math.pow(d.score, 3) * 20;})
      .attr("fill-opacity", function(d) { return Math.pow(d.score, 3);})
      .attr("fill", "gold");

    var tentativeCircles = keyloggerChart.selectAll(".tentative-circle")
      .data(tentative)
      .enter()
      .append("circle")
      .attr("class", "tentative-circle")
      .attr("cx", function(d) {return xScale(d.time)})
      .attr("cy", function(d) {return yScaleKeylogger(d.score)})
      .attr("r", function(d) { return d.sentence.length / 10;})

      // .attr("r", function(d) { return Math.pow(d.score, 3) * 20;})
      .attr("fill-opacity", function(d) { return Math.pow(d.score, 3);})
      .attr("fill", "lavender");

    var sadCircles = keyloggerChart.selectAll(".sad-circle")
      .data(sadness)
      .enter()
      .append("circle")
      .attr("class", "sad-circle")
      .attr("cx", function(d) {return xScale(d.time)})
      .attr("cy", function(d) {return yScaleKeylogger(d.score)})
      .attr("r", function(d) { return d.sentence.length / 10;})

      // .attr("r", function(d) { return Math.pow(d.score, 3) * 20;})
      .attr("fill-opacity", function(d) { return Math.pow(d.score, 3);})
      .attr("fill", "cyan");

    var fearCircles = keyloggerChart.selectAll(".fear-circle")
      .data(fear)
      .enter()
      .append("circle")
      .attr("class", "fear-circle")
      .attr("cx", function(d) {return xScale(d.time)})
      .attr("cy", function(d) {return yScaleKeylogger(d.score)})
      .attr("r", function(d) { return d.sentence.length / 10;})

      // .attr("r", function(d) { return Math.pow(d.score, 3) * 20;})
      .attr("fill-opacity", function(d) { return Math.pow(d.score, 3);})
      .attr("fill", "blue");

    var angryCircles = keyloggerChart.selectAll(".angry-circle")
      .data(anger)
      .enter()
      .append("circle")
      .attr("class", "angry-circle")
      .attr("cx", function(d) {return xScale(d.time)})
      .attr("cy", function(d) {return yScaleKeylogger(d.score)})
      .attr("r", function(d) { return d.sentence.length / 10;})

      // .attr("r", function(d) { return Math.pow(d.score, 3) * 20;})
      .attr("fill-opacity", function(d) { return Math.pow(d.score, 3);})
      .attr("fill", "deeppink");

    var disgustCircles = keyloggerChart.selectAll(".disgust-circle")
      .data(disgust)
      .enter()
      .append("circle")
      .attr("class", "disgust-circle")
      .attr("cx", function(d) {return xScale(d.time)})
      .attr("cy", function(d) {return yScaleKeylogger(d.score)})
      .attr("r", function(d) { return Math.pow(d.score, 3) * 20;})
      .attr("fill-opacity", 0.25)
      .attr("fill", "thistle");



    keyloggerSVG.selectAll("circle")
    .call(tip)

    .on("mouseover", function(d) {
      tip.show(d);
    })

    .on("mouseout", function(d) {
      tip.hide(d);
    })


}
  </script>

<script>

var affectivaHeight = 850;
var affectivaSVG = d3.select("#affectiva")
      .attr("width", width + margin.left + margin.right)
      .attr("height", affectivaHeight + margin.top + margin.bottom);

var blinksHeight = (affectivaHeight/10) * 2;
var blinksChart = affectivaSVG.append("g")
        .attr("height", blinksHeight)
        .attr("class", "blinksG")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

var expressionsHeight = (affectivaHeight/10) * 5;
var expressionsChart = affectivaSVG.append("g")
        .attr("height", expressionsHeight)
        .attr("class", "expressionsG")
        .attr("transform", "translate(" + margin.left + "," + (blinksHeight + margin.top) + ")");

var emojiHeight = (affectivaHeight/10) * 3;
var emojiChart = affectivaSVG.append("g")
        .attr("height", emojiHeight)
        .attr("class", "emojiG")
        .attr("transform", "translate(" + margin.left + "," + (expressionsHeight + blinksHeight + 90 + margin.top) + ")");

var yScaleExpressions = d3.scaleLinear()
  .range([expressionsHeight,0]);
var yAxisExpressions = d3.axisLeft(yScaleExpressions).tickSize(-width).ticks(4).tickPadding(10).tickFormat(function(d) { return d + "%"; });


var productivityArea = d3.area()
    .x(function(d) { return xScale(d[0]); })
    .y1(function(d) { return yScaleExpressions(d[4]); })
    .y0(expressionsHeight/2)
      .defined(function(d){return d[4]!=null;});


d3.json("merged_file.json", function (err, affectiva) {
  d3.json("productivity.json", function(err, rescuetime){
      if (err) console.warn(err, "error loading data");


productivity = rescuetime.rows;

productivity.forEach(function(d){
  var dateTime = new Date(String(d[0]));
  d[0] = dateTime;
})

newProductivity = [];

productivity.forEach(function(d, i){

  newProductivity.push(d);

  if(i == productivity.length-1){
    return;
  }
  var timee = productivity[i+1][0];


  if(d[0] < (timee - 3600000)) {
    var nullTime = new Date(timee - 3600000);
    var nullItems = [];
    nullItems[0] = nullTime;
    nullItems[1] = null;
    nullItems[2] = null;
    nullItems[3] = null;
    nullItems[4] = null;
    var nullIndex = i+1;
    newProductivity.push(nullItems);

  }

});


affectiva.sort(function(a,b) {return a.time - b.time});


affectiva.forEach(function(d){

    var dateTime = new Date(d.time);
    d.time = dateTime;
})


  yScaleExpressions.domain([-100,100]);



  var blinksTip = d3.tip()
    .attr("class", "tooltip")
    .offset([-22,-5])
    .direction("n")
    .html(function(d,i) {
    return d.blinks + " blinks";
    });



  var attentionTip = d3.tip()
    .attr("class", "tooltip")
    .offset([-24,-5])
    .html(function(d,i) {
    return "<b>Max Attention:</b> " + d.max_attention.toFixed(2) + "% <br><b>Min Attention:</b> " + d.min_attention.toFixed(2) + "%";
    });


  var valenceTip = d3.tip()
    .attr("class", "tooltip")
    .offset([22,-5])
    .direction("s")
    .html(function(d,i) {
    return "<b>Max Valence:</b> " + d.max_valence.toFixed(2) + "% <br><b>Min Valence:</b> " + d.min_valence.toFixed(2) + "% <p><span style='font-size:16px'>" + d.emoji + "</span></p>";
    });

  var markers = [
   { id:0, name: 'attention', path: 'M 0,0 m -1,-4.5 L 1,-4.5 L 1,4.5 L -1,4.5 Z', fill: 'fuchsia', viewbox: '-1 -5 2 10' },
   { id: 1, name: 'engagement', path: 'M 0,0 m -1,-2.5 L 1,-2.5 L 1,2.5 L -1,2.5 Z', fill: 'gold', viewbox: '-1 -5 2 10' },
   { id: 2, name: 'valence', path: 'M 0,0 m -1,-4.5 L 1,-4.5 L 1,4.5 L -1,4.5 Z', fill: 'cyan', viewbox: '-1 -5 2 10' },
  ]


    var defs = affectivaSVG.append('svg:defs')

  var marker = defs.selectAll('marker')
    .data(markers)
    .enter()
    .append('svg:marker')
      .attr('id', function(d){ return 'marker_' + d.name})
      .attr('markerHeight', 5)
      .attr('markerWidth', 5)
      .attr('markerUnits', 'strokeWidth')
      .attr('orient', 'auto')
      .attr('refX', 0)
      .attr('refY', 0)
      .attr('viewBox', function(d){ return d.viewbox })
      .append('svg:path')
        .attr('d', function(d){ return d.path })
        .attr("fill", function(d){return d.fill})
        .attr("fill-opacity", 0.3);



  blinksChart.append("line")
    .style("stroke", "#e0e0e0")
    .style("stroke-dasharray", ("5,5"))
    .attr("x1", -30)
    .attr("y1", 60)
    .attr("x2", width)
    .attr("y2", 60);

  blinksChart.append("text")
    .attr("class", "alt-axis")
    .attr("y", 60)
    .attr("x", -30)
    .text("BLINKS/MIN");

  var blinkCircles = blinksChart.selectAll(".blink-circle")
    .data(affectiva)
    .enter()
    .append("circle")
    .attr("class","blink-circle")
    .attr("cx", function(d) {return xScale(d.time)})
    .attr("cy", 60)
    .attr("r", function(d) { return d.blinks * 1.5;})
    .attr("fill-opacity", 0.6)
    .attr("fill", "blue");



    blinksChart.selectAll(".blink-circle")
    .call(blinksTip)

    .on("mouseover", function(d) {
      blinksTip.show(d);
    })

    .on("mouseout", function(d) {
      blinksTip.hide(d);
    })



  expressionsChart.append("g")
    .attr("class", "axis axis--x")
    .attr("transform","translate(0, "+expressionsHeight+")")
    .call(xAxis);

  expressionsChart.append("g")
  .attr("class", "axis axis--y")
    .call(yAxisExpressions);


  expressionsChart.append("line")
    .style("stroke", "#e0e0e0")
    .style("stroke-dasharray", ("5,5"))
    .attr("x1", 0)
    .attr("y1", yScaleExpressions(50))
    .attr("x2", width)
    .attr("y2", yScaleExpressions(50));




 expressionsChart.append("path")
    .datum(newProductivity)
    .attr("d", productivityArea)
    .attr("fill", "gold")
    .attr("opacity", 0.35)
    .attr("class", "productivityArea");



    var valenceLines = expressionsChart.selectAll(".valenceLines")
    .data(affectiva)
    .enter()
    .append("line")
    .attr("class", "valenceLines")
    .attr("stroke", "cyan")
    .attr("stroke-width", 2.25)
    .attr("stroke-opacity", 0.6)
    .attr("x1", function(d){ return xScale(d.time);})
    .attr("x2", function(d) {return xScale(d.time);})
    .attr("y1", function(d){return yScaleExpressions(d.min_valence)})
    .attr("y2", function(d) {return yScaleExpressions(d.max_valence)})
    .attr('marker-start', 'url(#marker_valence)')
    .attr('marker-end', 'url(#marker_valence)');

    var attentionLines = expressionsChart.selectAll(".attentionLines")
    .data(affectiva)
    .enter()
    .append("line")
    .attr("class", "attentionLines")
    .attr("stroke", "fuchsia")
    .attr("stroke-width", 2.25)
    .attr("stroke-opacity", 0.6)
    // .attr("stroke-linecap", "butt")
    .attr("x1", function(d){ return xScale(d.time);})
    .attr("x2", function(d) {return xScale(d.time);})
    .attr("y1", function(d){return yScaleExpressions(d.min_attention)})
    .attr("y2", function(d) {return yScaleExpressions(d.max_attention)})
    .attr('marker-start', 'url(#marker_attention)')
    .attr('marker-end', 'url(#marker_attention)');




  expressionsChart.selectAll(".attentionLines")
  .call(attentionTip)

  .on("mouseover", function(d) {
    attentionTip.show(d);
  })

  .on("mouseout", function(d) {
    attentionTip.hide(d);
  })


  expressionsChart.selectAll(".valenceLines")
  .call(valenceTip)

  .on("mouseover", function(d) {
    valenceTip.show(d);
  })

  .on("mouseout", function(d) {
    valenceTip.hide(d);
  })


  emojiChart.append("line")
    .style("stroke", "#e0e0e0")
    .style("stroke-dasharray", ("5,5"))
    .attr("x1", -30)
    .attr("y1", 110)
    .attr("x2", width)
    .attr("y2", 110);

  emojiChart.append("text")
    .attr("class", "alt-axis")
    .attr("y", 110)
    .attr("x", -30)
    .text("EXPRESSIONS");

    var j = 0;
    var k = 0;

    var emoji = emojiChart.selectAll(".emoji")
      .data(affectiva)
      .enter()
      .append("g")
      .attr("class", "emoji")
      .attr("transform", function(d) {
        return "translate(" + (xScale(d.time)-7) + ")";})
      .selectAll(".emoji")
      .data(function(d) {
        return d.emoji;
      })
      .enter()
      .append("g")
      .attr("transform", function(d,i) {
        if (i == 0) {
          j = 0;
          k = 0;
        }
        if (d <= "üòè" || d >= "üòò" && d <="üòù" || d == "üòó") { //happy
          var translate_string = "translate(0," + (yScaleExpressions(j*19)/2.5) + ")";
          j += 1;
          return translate_string;
        }
        else if (d > "üòè" && d < "üòò" || d > "üòù") { //sad
          var translate_string = "translate(0," + (235 - yScaleExpressions(k*19)/2.5) + ")";
          k += 1;
          return translate_string;
        }
      })
      .append("text")
      .text(function(d) {return d;})
        .attr("font-size", "18px");



})
});

</script>


<script>

var dataset; 
// var tabCounterChartHeight = 800;
// var tabCounterHeight = 500;
// var faviconHeight = 300;

var tabCounterSVG = d3.select("#tabCounter")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom);
var tabCounterChart = tabCounterSVG.append("g")
      .attr("class", "tabCounterG")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
      // .attr("height", tabCounterHeight);
// var faviconChart = tabCounterSVG.append("g")
//       .attr("class", "faviconG")
//       .attr("transform", "translate(" + margin.left + "," + (margin.top + faviconHeight) + ")")
//       .attr("height", faviconHeight);


var yScaleTabCounter = d3.scaleLinear()
  .range([height,0]);
  // .domain([0.45,1]);
var yAxisTabCounter = d3.axisLeft(yScaleTabCounter).tickSize(-width).ticks(4).tickPadding(10);


var tabLine = d3.line()
.defined(function(d){return dataset[d].current_tabCount!=null})
  .x(function(d) {return xScale(dataset[d].timestamp);})
  .y(function(d){return yScaleTabCounter(dataset[d].current_tabCount);});

var windowLine = d3.line()
.defined(function(d){return dataset[d].current_windowCount!=null})
  .x(function(d) {return xScale(dataset[d].timestamp);})
  .y(function(d){return yScaleTabCounter(dataset[d].current_windowCount);});


d3.json("chromeactivity.json", ready);

function ready(err, data) {
    if (err) console.warn(err, "error loading data");


dataset = data;


var keyLookup = [];

for(var key in dataset){
  // console.log(dataset[key])
  var dateTime = new Date(dataset[key].timestamp)
  dataset[key].timestamp = dateTime;
  keyLookup.push(key);

  if(!dataset[key].favicons){
    dataset[key]["favicons"] = [];
  }
}


for(var key in dataset){

  var currentIndex = keyLookup.indexOf(key);

  if(currentIndex < keyLookup.length - 1){
    var currentTime = dataset[key].timestamp;
    var nextTime = dataset[keyLookup[currentIndex+1]].timestamp;


    if (currentTime < (nextTime - 24000000)) {
      var nullTime = nextTime - 24000000;
      var nullItems = {};

      nullItems["timestamp"] = new Date(nullTime);
      nullItems["current_windowCount"] = null;
      nullItems["current_tabCount"] = null;
      nullItems["favicons"] = [];
      nullItems["tabs_activated"] = null;
      nullItems["tabs_created"] = null;
      nullItems["windows_created"] = null;

      dataset[nullTime] = nullItems;
    }

    else if (currentTime > (nextTime - 1800000)) {
      var currentTimeMs = currentTime.getTime();
      var nextTimeMs = nextTime.getTime();
      dataset[currentTimeMs].tabs_activated += dataset[nextTimeMs].tabs_activated;
      dataset[currentTimeMs].tabs_created += dataset[nextTimeMs].tabs_created;
      dataset[currentTimeMs].windows_created += dataset[nextTimeMs].windows_created;
      delete dataset[nextTimeMs];
    }
  }
}


keyLookup = [];

for(var key in dataset){
    keyLookup.push(key);
}


// console.log(dataset)

  var yMax = d3.extent(keyLookup, function(d) {return dataset[d].tabs_activated;})[1];
  yScaleTabCounter.domain([0,yMax]);
  // xScale2.domain(xScale.domain());
  // yScale2.domain(yScale.domain());


  var tabTip = d3.tip()
    .attr("class", "tooltip")
    .offset([-22,-5])
    .direction("n")
    .html(function(d) {
      var imgString = "";
      for(var i = 0; i < dataset[d].favicons.length; i++){
        var jnURL = "http://localhost:8888/static/base/images/"
        if(dataset[d].favicons[i].includes(jnURL)){
        imgString += "<img src='http://xujenna.com/speakmemory/imgs/"+dataset[d].favicons[i].slice(jnURL.length)+"' width='13px' height='13px'>"
        }
        else{
        imgString += "<img src='"+dataset[d].favicons[i]+"' width='13px' height='13px'>"
        }
      }
      return "<b>Tabs Activated:</b> "+dataset[d].tabs_activated+"<br><br>" + imgString;
    });

  var tabCreatedTip = d3.tip()
    .attr("class", "tooltip")
    .offset([-22,-5])
    .direction("n")
    .html(function(d) {
      return "<b>Tabs Created:</b> "+dataset[d].tabs_created;
    });

  var tabCountTip = d3.tip()
    .attr("class", "tooltip")
    .offset([-22,-5])
    .direction("n")
    .html(function(d) {
      return "<b>Tabs Left Open:</b> "+dataset[d].current_tabCount;
    });

  var windowCountTip = d3.tip()
    .attr("class", "tooltip")
    .offset([-22,-5])
    .direction("n")
    .html(function(d) {
      return "<b>Windows Left Open:</b> "+dataset[d].current_windowCount;
    });



  tabCounterChart.append("g")
    .attr("class", "axis axis--x")
    .attr("transform","translate(0, "+(height)+")")
    .call(xAxis);

  tabCounterChart.append("g")
  .attr("class", "axis axis--y")
    .call(yAxisTabCounter);

var pixelInterval = xScale(new Date("Sun Apr 29 2018 02:00:00 GMT-0500 (CDT)")) - xScale( new Date("Sun Apr 29 2018 01:00:00 GMT-0500 (CDT)"));



 tabCounterChart.selectAll(".activated-bar")
      .data(keyLookup)
    .enter().append("rect")
      .attr("class", "activated-bar")
      .style("fill", "gold")
      .style("opacity", 0.5)
      .attr("x", function(d) { return xScale(dataset[d].timestamp); })
      .attr("width", pixelInterval)
      // .attr("width", function(d){ return xScale(dataset[d].timestamp)/ keyLookup.length})
      .attr("y", function(d) { return yScaleTabCounter(dataset[d].tabs_activated); })
      .attr("height", function(d) { return height - yScaleTabCounter(dataset[d].tabs_activated); });

tabCounterChart.selectAll(".created-bar")
    .data(keyLookup)
  .enter().append("rect")
    .attr("class", "created-bar")
    .style("fill", "cyan")
    .style("opacity", 0.5)
    .attr("x", function(d) { return xScale(dataset[d].timestamp); })
    .attr("width", pixelInterval)
    // .attr("width", function(d){ return xScale(dataset[d].timestamp)/ keyLookup.length})
    .attr("y", function(d) { return yScaleTabCounter(dataset[d].tabs_created); })
    .attr("height", function(d) { return height - yScaleTabCounter(dataset[d].tabs_created); });

tabCounterChart.append("path")
  .datum(keyLookup)
  .attr("d", tabLine)
  .attr("stroke", "magenta")
  .attr("stroke-width", 2)
  .attr("fill", "none")
  .attr("class", "tabLine")
  .attr("opacity", 0.6);

// tabCounterChart.append("path")
//   .datum(keyLookup)
//   .attr("d", windowLine)
//   .attr("stroke", "blue")
//   .attr("stroke-width", 2)
//   .attr("fill", "none")
//   .attr("class", "windowLine")
//   .attr("opacity", 0.6);

tabCounterChart.selectAll(".tabCircle")
  .data(keyLookup)
  .enter()
  .append("circle")
  .attr("class","tabCircle")
  .attr("cx", function(d) {return xScale(dataset[d].timestamp)})
  .attr("r", function(d) {return dataset[d].current_tabCount == null ? 0 : 3; })
  .attr("cy", function(d) { return yScaleTabCounter(dataset[d].current_tabCount);})
  .attr("opacity", 0.7)
  .attr("fill", "magenta");


tabCounterChart.selectAll(".activated-bar")
.call(tabTip)

.on("mouseover", function(d) {
  tabTip.show(d);
})

.on("mouseout", function(d) {
  tabTip.hide(d);
})


tabCounterChart.selectAll(".created-bar")
.call(tabCreatedTip)

.on("mouseover", function(d) {
  tabCreatedTip.show(d);
})

.on("mouseout", function(d) {
  tabCreatedTip.hide(d);
})


tabCounterChart.selectAll(".tabCircle")
.call(tabCountTip)

.on("mouseover", function(d) {
  tabCountTip.show(d);
})

.on("mouseout", function(d) {
  tabCountTip.hide(d);
})


}

</script>


<script>

// correlation matrix adapted from https://bl.ocks.org/emeeks/671c0e7adfb1ce7060b8
// linear regression adapted from https://bl.ocks.org/HarryStevens/be559bed98d662f69e68fc8a7e0ad097


d3.tsv("mergedDF.tsv", function(err, data) {
  d3.tsv("correlationmatrix.tsv", function(err, correlationData) {
      if (err) console.warn(err, "error loading data");


var correlationSVG = d3.select("#correlations")
      .attr("width", width + margin.left + margin.right)

  // attributes = d3.keys(data[0])
  attributes = ["All", "mood", "social", "alone", "morale", "stress", "fatigue", "compulsions", "leisure_activity", "feedly_activity", "with_friends_activity", "errands_activity", "ash_stuff_activity", "chatting_activity", "with_k_activity", "in_class_activity", "therapy_activity", "home_location", "school_location", "kevin_home_location", "Sadness_score", "Analytical_score", "Joy_score", "Fear_score", "Tentative_score", "Anger_score", "Confident_score", "blinks", "max_attention", "max_valence", "productivity_score"]
    // attributes = ["mood", "social", "morale", "stress", "fatigue", "compulsions", "productivity_score", "blinks", "Sadness_score", "Joy_score", "Tentative_score", "Confident_score", "min_attention", "min_valence", "feedly_activity", "with_k_activity", "with_friends_activity", "leisure_activity", "home_location", "school_location", "All"]

    attribute_descriptions = {mood: "Mood Reporter data on scale of 0-5", social: "Mood Reporter data on number of social interactions", alone: "Mood Reporter data (T/F)", morale: "Mood Reporter data on scale of 0-5", stress: "Mood Reporter data on scale of 0-5", fatigue: "Mood Reporter data on scale of 0-5", compulsions: "Mood Reporter data on compulsions (T/F)", productivity_score: "Productivity_score, calculated by the RescueTime App on scale of 0-100%", blinks: "Count per minute, calculated with Facial Analysis data", Sadness_score: "Sentiment analysis score from Keylogger data", Joy_score: "Sentiment analysis score from Keylogger data", Tentative_score: "Sentiment analysis score from Keylogger data", Confident_score: "Sentiment analysis score from Keylogger data", Analytical_score: "Sentiment analysis score from Keylogger data", Fear_score: "Sentiment analysis score from Keylogger data", Anger_score: "Sentiment analysis score from Keylogger data", max_attention: "Max attention score calculated with Facial Analysis data", max_valence: "Max valence score calculated with Facial Analysis data", feedly_activity: "Mood Reporter data on usage of Feedly (T/F)", with_k_activity: "Mood Reporter data on time with boyfriend (T/F)", with_friends_activity: "Mood Reporter data on time with friends (T/F)", leisure_activity: "Mood Reporter data on leisure time (T/F)", errands_activity: "Mood Reporter data on time spent on errands (T/F)", ash_stuff_activity: "Mood Reporter data on time spent on pro bono work (T/F)", chatting_activity: "Mood Reporter data on time spent chatting (T/F)", in_class_activity: "Mood Reporter data on time spent in class (T/F)", therapy_activity: "Mood Reporter data on time spent in therapy (T/F)", home_location: "Mood Reporter data on time spent at home (T/F)", school_location: "Mood Reporter data on time spent at school (T/F)", kevin_home_location: "Mood Reporter data on time spent at boyfriend's house (T/F)", All: "All variables"}


  d3.select("#selection1").selectAll("options")
    .data(attributes)
    .enter().append("option")
    .text(function(d){return d})

  d3.select("#selection2").selectAll("options")
    .data(attributes)
    .enter().append("option")
    .text(function(d){return d})

  attributeMatrix = [];

  attributes.forEach(function(a,x) {
    attributes.forEach(function(b,y){
      if(y == attributes.length || x == attributes.length){
        return
      }
      else{
      attributeMatrix.push({a: a, b:b, x:x, y:y})
    }
    })
  })


  data.forEach(function (d) {
    attributes.forEach(function (att) {
      if(d[att] == "False"){
        d[att] = 0;
      }
      else if (d[att] == "True") {
        d[att] = 1;
      }
      else {
        d[att] = parseFloat(d[att])
      }
    })
  })

  //create scales dynamically for each attribute's extent

  scale = {};
  attributes.forEach(function (att) {
    scale[att] = d3.scaleLinear();
    attExtent = d3.extent(data, function (d) {return d[att]});
    scale[att].domain(attExtent);
  })


var selection1 = document.querySelector('#selection1');
selection1.addEventListener('input', getInput)

var selection2 = document.querySelector('#selection2');
selection2.addEventListener('input', getInput)

function getInput() {

  var input1 = document.getElementById("selection1").value
  var input2 = document.getElementById("selection2").value

  var newMatrix = [];
  var attributeSet = new Set()

  if(input1 == "Select an X-Axis Metric:" || input2 == "Select an Y-Axis Metric:"){
    return
  }
  if(input1 == "All" && input2 =="All"){

    attributeSet = new Set(attributes);

    correlationData.forEach(function(d){
      if(attributeSet.has(d.index)){
        attributeSet.forEach(function(att){
          if(att != "All"){
          newMatrix.push({a: d.index, b:att, corr: d[att]})
          }
        })

      }
    })

  }
  else if(input1 == "All") {
    attributeSet.add(input2)
    attributeMatrix.forEach(function(d){
      if(d.b == input2) { 
        if(d.a != "All" && d.a != d.b) {
          newMatrix.push(d)
          attributeSet.add(d.a)
        }        

      }
    })
  }
  else if (input2 == "All"){
    attributeSet.add(input1)
    attributeMatrix.forEach(function(d){
      if(d.a == input1) {
        if(d.b != "All" && d.b != d.a) {
          newMatrix.push(d)
          attributeSet.add(d.b)
        }        

      }
    })
  }
  else {
    newMatrix.push({a: input1, b:input2})
    attributeSet.add(input1)
    attributeSet.add(input2)

  }

  var variable_description = document.querySelector("#variable-description")
  variable_description.innerHTML = null


attributeSet.forEach(function(d){
  // var newP = document.createTextNode("<b>"+ d + ": </b>" + attribute_descriptions[d])
  var newP = document.createElement("p")

  var newPair = "<b>"+ d + ": </b>" + attribute_descriptions[d]

  newP.innerHTML = newPair

  variable_description.appendChild(newP)

})

attributeSet.clear()



if(newMatrix.length > 300) {
  var containerWidth = width/32.25;
  var containerHeight = width/32.25;
  var chartHeight = width/35.25;
  var chartWidth = width/35.25;
  var rowLength = 30;
  margin.left += 30;
  margin.top +=30;
}
else if(newMatrix.length < 300 && newMatrix.length > 2){
  var containerWidth = width/4.75;
  var containerHeight = width/4.75;
  var chartHeight = width/6.75;
  var chartWidth = width/6.75;
  var rowLength = 5;
  var tickNumX = 4;
  var tickNumY = 4;
  var tickSize = 2;
  var tickPadding = 2;
  var axisClass = "smallAxis";
  var radius = 2;
  var labelClass = "smallAxisLabel"
  margin.left = 50;
  margin.top = 50;
}
else if (newMatrix.length < 2){
  var containerWidth = width/2;
  var containerHeight = width/2.5;
  var chartHeight = 400;
  var chartWidth = 900;
  var rowLength = 1;
  var tickNumX = 12;
  var tickNumY = 6;
  var tickSize = -chartWidth;
  var tickPadding = 10;
  var axisClass = "axis";
  var radius = 4;
  var labelClass = "axisLabel"
  margin.left = 50;
  margin.top = 50;
}

// 
// d3.select("svg")
correlationSVG
.html("")
.attr("height", Math.ceil((newMatrix.length / rowLength)  * containerHeight) + margin.top + margin.bottom)
// .attr("width", width + margin.left + margin.right)



var rows = 0;
var j = -1;

correlationSVG  
  .selectAll("g")
  .data(newMatrix)
  .enter()
  .append("g")
  .attr("transform", function (d,i) {
      if(i > 0 && i%rowLength == 0){
        rows += 1;
        j=0;
        return "translate(" + ((j * containerWidth) + margin.left) + "," + ((rows * containerHeight) + margin.top) + ")" 
      }
      else{
        j +=1;
        return "translate(" + ((j * containerWidth) + margin.left) + "," + ((rows * containerHeight) + margin.top) + ")" 
      }
  });


correlationSVG.selectAll("g").each(function(pair,i){


  if(pair.a == pair.b && newMatrix.length < 2){
    return
  }
  else if(newMatrix.length < 300) {

    scale[pair.a].range([0,chartWidth]);
    scale[pair.b].range([chartHeight,0]);

    d3.select(this).append("rect").style("fill", "none").style("stroke", "none").style("stroke-width", 0)
    .attr("height", chartHeight)
    .attr("width", chartWidth)

      var xAxisCorr = d3.axisBottom()
          .scale(scale[pair.a])
          .tickSize(3)
          .ticks(tickNumX)
          .tickPadding(tickPadding);

      var yAxisCorr = d3.axisLeft()
          .scale(scale[pair.b])
          .tickSize(tickSize)
          .ticks(tickNumY)
          .tickPadding(tickPadding);

      d3.select(this).append("g")
        .attr("class", axisClass)
        .attr("transform", "translate(0," + chartHeight + ")")
        .call(xAxisCorr)

      d3.select(this).append("g")
          .attr("class", axisClass)
          .call(yAxisCorr);

      if(newMatrix.length > 2){
          d3.select(this).append("text")
          .attr("class", labelClass)
          .attr("x", (chartWidth/2) + 5)
          .style("text-anchor", "middle")
          .attr("y", 7)
          .attr("fill", "black")

          .text(function(d){
            var string = pair.a + pair.b;

            if(string.length <= 20){
              return pair.a.toUpperCase() + " - " + pair.b.toUpperCase();
            }
            else if(string.length > 20){
              return pair.a.toUpperCase() + " -";
            }
          })
          d3.select(this).append("text")
          .attr("class",labelClass)
          .attr("x", (chartWidth/2) + 5)
          .style("text-anchor", "middle")
          .attr("y", 20)
          .attr("fill", "black")
          .text(function(d){
            var string = pair.a + pair.b;
            if(string.length > 20){
              return pair.b.toUpperCase()
            }
          });
        }
      else if (newMatrix.length < 2){
        d3.select(this).append("text")
          .attr("class", labelClass)
          .attr("x", (chartWidth/2))
          .attr("y", chartHeight + 60)
          .attr("fill", "black")
          .text(function(d){
            return pair.a
          })
       d3.select(this).append("text")
          .attr("class", labelClass)
          .attr("transform", "rotate(-90)")
          .attr("x", 0 - (chartHeight/2))
          .attr("y", -50)
          .style("text-anchor", "middle")
          .attr("fill", "black")
          .text(function(d){
            return pair.b
          })
      }
    }
    else if (newMatrix.length >300) {
      scale[pair.a].range([4,chartWidth]);
      scale[pair.b].range([chartHeight,4]);

      var corr_color = d3.scaleLinear()
        .domain([-1,0,1])
        .range(["blue", "#fcf9ef", "magenta"])

      d3.select(this).append("rect").style("fill", corr_color(pair.corr)).style("stroke", "#fcf9ef").style("stroke-width", 2)
      .attr("height", containerHeight)
      .attr("width", containerWidth)


      if (i == 0) {
        d3.select(this).append("text")
        .attr("class", "matrix-label")
        .attr("x", 10)
        .attr("y", 5)
        .attr("fill", "black")
        .text(pair.b.toUpperCase())  
        d3.select(this).append("text")
        .attr("class", "matrix-label")
        .attr("x", -10)
        .attr("y", 5)
        .attr("fill", "black")
        .style("text-anchor", "end")
        .text(pair.a.toUpperCase())
      }
      else if(i < 30){
        d3.select(this).append("text")
        .attr("class", "matrix-label")
        .attr("x", 10)
        .attr("y", 5)
        .attr("fill", "black")
        .text(pair.b.toUpperCase())  
      }
      else if(i%30 == 0){
        d3.select(this).append("text")
        .attr("class", "matrix-label")
        .attr("x", -10)
        .attr("y", 5)
        .attr("fill", "black")
        .style("text-anchor", "end")
        .text(pair.a.toUpperCase())
      }

  var corrTip = d3.tip()
    .attr("class", "tooltip")
    .offset([-20,-5])
    .html(function(d,i) {
    return "<b>" + d.a + ",<br>" + d.b + ":</b><br>" + d.corr;
    });

   correlationSVG.selectAll("rect")
    .call(corrTip)

    .on("mouseover", function(d) {
      corrTip.show(d);
    })

    .on("mouseout", function(d) {
      corrTip.hide(d);
    })
    return
  }



    var lg = calcLinear(data, pair.a, pair.b, 
          d3.min(data, function(d){ return d[pair.a] }), 
          d3.min(data, function(d){ return d[pair.b] }), 
          d3.max(data, function(d){ return d[pair.a] }));

    var circleclass;

    d3.select(this).append("line")
          .attr("class", "regression")
          .attr("x1", scale[pair.a](lg.ptA.x))
          .attr("y1", scale[pair.b](lg.ptA.y))
          .attr("x2", scale[pair.a](lg.ptB.x))
          .attr("y2", scale[pair.b](lg.ptB.y))
          .attr("stroke", function(d){
            if (pair.b == pair.a){
              circleclass = "silver";
              return "silver";
            }
            else if((scale[pair.b](lg.ptA.y)) >(scale[pair.b](lg.ptB.y))){
              circleclass = "magenta";
              return "magenta";
            }
            else {
              circleclass = "blue";
              return "blue";
            }
          });

        // scatterplot points
      d3.select(this).selectAll("circle")
      .data(data)
      .enter()
      .append("circle")
      .attr("r", radius)
      .style("fill", circleclass)
      // .style("fill", colors(i))
      .style("opacity", 0.11)
      .attr("cx", function (d) {
        return scale[pair.a](d[pair.a])
      })
      .attr("cy", function (d) {return scale[pair.b](d[pair.b])});

    })


   // Calculate a linear regression from the data

    // Takes 5 parameters:
    // (1) Your data
    // (2) The column of data plotted on your x-axis
    // (3) The column of data plotted on your y-axis
    // (4) The minimum value of your x-axis
    // (5) The minimum value of your y-axis

    // Returns an object with two points, where each point is an object with an x and y coordinate

    function calcLinear(data, x, y, minX, minY, maxX){
      /////////
      //SLOPE//
      /////////

      // Let n = the number of data points
      var n = data.length;

      // Get just the points
      var pts = [];
      data.forEach(function(d,i){
        // console.log("+d[x]", +d[x])
        var obj = {};
        obj.x = +d[x];
        obj.y = +d[y];
        obj.mult = obj.x*obj.y;
        pts.push(obj);
      });

      // Let a equal n times the summation of all x-values multiplied by their corresponding y-values
      // Let b equal the sum of all x-values times the sum of all y-values
      // Let c equal n times the sum of all squared x-values
      // Let d equal the squared sum of all x-values
      var sum = 0;
      var xSum = 0;
      var ySum = 0;
      var sumSq = 0;
      pts.forEach(function(pt){
        // console.log(pt)
        sum = sum + pt.mult;
        xSum = xSum + pt.x;
        ySum = ySum + pt.y;
        sumSq = sumSq + (pt.x * pt.x);
      });

      var a = sum * n;
      var b = xSum * ySum;
      var c = sumSq * n;
      var d = xSum * xSum;


      // Plug the values that you calculated for a, b, c, and d into the following equation to calculate the slope
      // slope = m = (a - b) / (c - d)
      var m = (a - b) / (c - d);
      /////////////
      //INTERCEPT//
      /////////////

      // Let e equal the sum of all y-values
      var e = ySum;
      // Let f equal the slope times the sum of all x-values
      var f = m * xSum;
      // Plug the values you have calculated for e and f into the following equation for the y-intercept
      // y-intercept = b = (e - f) / n
      var b = (e - f) / n;

      // return an object of two points
      // each point is an object with an x and y coordinate
      return {
        ptA : {
          x:minX,
          y: m * minX + b
          // x: minX,
          // y: m * minX + b
        },
        ptB : {
          x: maxX,
          y: m * maxX + b
          // y: minY,
          // x: (minY - b) / m
        }
      }
    }

}
  })
});

</script>

</body>
